(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-product-addProduct-addProduct"],{"6e3e":function(t,e,n){"use strict";var i=n("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n("96cf");var r=i(n("3b8d")),a={data:function(){return{items:[],current:0,form:{name:"",image:"",video:"",intro:"",online:1,pType:1,showType:0,category:""},type:"",id:"",confirmBtnName:"确定"}},onLoad:function(t){var e=this;(0,r.default)(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){while(1)switch(n.prev=n.next){case 0:return console.log(t),e.type=t.type,e.id=t.id,n.next=5,e.selectCategory();case 5:"modify"===e.type&&(e.confirmBtnName="修改",e.selectDetail());case 6:case"end":return n.stop()}},n,this)}))()},methods:{selectCategory:function(){var t=(0,r.default)(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$util.request({requestUrl:"api/category"});case 2:e=t.sent,console.log("查询所有类别：",e),e&&(this.items=e.data.data,0===this.items.length?this.$util.toast("无类别可选，请先去添加类别"):"modify"!==this.type&&(this.current=0,this.form.category=this.items[0].id));case 5:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),selectDetail:function(){var t=(0,r.default)(regeneratorRuntime.mark(function t(){var e,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$util.request({requestUrl:"api/products/"+this.id});case 2:if(e=t.sent,console.log("查询商品详情",e),!e){t.next=15;break}this.form=e.data.data[0],n=0;case 7:if(!(n<this.items.length)){t.next=15;break}if(this.items[n].id!==this.form.category){t.next=12;break}return this.current=n,this.form.category=this.items[n].id,t.abrupt("break",15);case 12:n++,t.next=7;break;case 15:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),uploadVideo:function(){var t="",e=this;uni.chooseVideo({count:1,sourceType:["camera","album"],success:function(n){t=n.tempFilePath,uni.uploadFile({url:e.$util.url+"api/upload",filePath:t,fileType:"video",name:"file",success:function(t){e.$util.toast("上传成功"),e.form.video=JSON.parse(t.data).data.url},fail:function(t){e.$util.toast("上传失败")}})}})},uploadImage:function(){var t=(0,r.default)(regeneratorRuntime.mark(function t(){var e,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$util.selectImage();case 2:return e=t.sent,t.next=5,this.$util.uploadImage(e);case 5:n=t.sent,this.form.image=n;case 7:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),confirm:function(){var t=(0,r.default)(regeneratorRuntime.mark(function t(){var e,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(""!==this.form.category){t.next=3;break}return this.$util.toast("请选择类别"),t.abrupt("return");case 3:if(""!==this.form.name){t.next=6;break}return this.$util.toast("请输入名称"),t.abrupt("return");case 6:if(""!==this.form.intro){t.next=9;break}return this.$util.toast("请输入描述"),t.abrupt("return");case 9:if(""!==this.form.image){t.next=12;break}return this.$util.toast("请上传图片"),t.abrupt("return");case 12:if(1!==this.form.showType||""!==this.form.video){t.next=15;break}return this.$util.toast("请上传视频"),t.abrupt("return");case 15:if(console.log(this.form),"modify"!==this.type){t.next=24;break}return t.next=19,this.$util.request({requestUrl:"api/products/"+this.id,method:"PUT",data:this.form});case 19:e=t.sent,console.log("修改商品信息",e),e&&(this.$util.toast("修改成功"),setTimeout(function(){uni.navigateBack()},500)),t.next=29;break;case 24:return t.next=26,this.$util.request({requestUrl:"api/products",method:"POST",data:this.form});case 26:n=t.sent,console.log("添加商品",n),n&&(this.$util.toast("添加成功"),this.current=0,this.form={name:"",image:"",video:"",intro:"",online:1,pType:1,showType:0,category:this.items[0].id,type:"",id:""});case 29:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),radioChange:function(t){for(var e=0;e<this.items.length;e++)if(this.items[e].id===t.target.value){this.current=e,this.form.category=this.items[e].id;break}},switch1Change:function(t){t.target.value?this.form.online=1:this.form.online=0},switch2Change:function(t){t.target.value?this.form.pType=1:this.form.pType=0},switch3Change:function(t){t.target.value?this.form.showType=1:(this.form.showType=0,this.form.video="")}}};e.default=a},bff4:function(t,e,n){"use strict";n.r(e);var i=n("e256"),r=n("d734");for(var a in r)"default"!==a&&function(t){n.d(e,t,function(){return r[t]})}(a);var o=n("2877"),u=Object(o["a"])(r["default"],i["a"],i["b"],!1,null,"610b4a85",null);e["default"]=u.exports},d734:function(t,e,n){"use strict";n.r(e);var i=n("6e3e"),r=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,function(){return i[t]})}(a);e["default"]=r.a},e256:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",[n("v-uni-view",[t._v("选择类别")]),n("v-uni-radio-group",{on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.radioChange.apply(void 0,arguments)}}},t._l(t.items,function(e,i){return n("v-uni-label",{key:e.id,staticClass:"uni-list-cell uni-list-cell-pd"},[n("v-uni-view",[n("v-uni-radio",{attrs:{value:e.id,checked:i===t.current}})],1),n("v-uni-view",[t._v(t._s(e.name))])],1)}),1),n("v-uni-view",[n("v-uni-input",{attrs:{placeholder:"输入名称",type:"text"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),n("v-uni-view",[n("v-uni-input",{attrs:{placeholder:"输入描述",type:"text"},model:{value:t.form.intro,callback:function(e){t.$set(t.form,"intro",e)},expression:"form.intro"}})],1),n("v-uni-view",[n("v-uni-view",[t._v("上架")]),n("v-uni-switch",{attrs:{checked:1==t.form.online},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.switch1Change.apply(void 0,arguments)}}})],1),n("v-uni-view",[n("v-uni-view",[t._v("属于本店")]),n("v-uni-switch",{attrs:{checked:1==t.form.pType},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.switch2Change.apply(void 0,arguments)}}})],1),n("v-uni-view",[n("v-uni-view",[t._v("上传图片/视频：(选择视频的话都得传，非视频的话只传图片)")]),n("v-uni-view",[t._v("视频")]),n("v-uni-switch",{attrs:{checked:1==t.form.showType},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.switch3Change.apply(void 0,arguments)}}})],1),n("v-uni-image",{attrs:{src:t.form.image}}),n("v-uni-video",{attrs:{src:t.form.video}}),n("v-uni-button",{on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.uploadImage.apply(void 0,arguments)}}},[t._v("上传图片")]),n("v-uni-button",{on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.uploadVideo.apply(void 0,arguments)}}},[t._v("上传视频")]),n("v-uni-button",{on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.confirm.apply(void 0,arguments)}}},[t._v(t._s(t.confirmBtnName))])],1)},r=[];n.d(e,"a",function(){return i}),n.d(e,"b",function(){return r})}}]);